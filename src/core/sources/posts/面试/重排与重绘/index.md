---

# 默认为文件名称
title: 

tags:
  - 渲染
  - 重绘
  - 重排
  - 回流

# 类别中已包含文件夹名称
categories:

description: 浏览器渲染页面的流程，重绘与重拍何时发生，怎么减少它们来提高性能？ 

# 该字段必须,格式 <YYYY-MM-DD hh:mm:ss>
publishTime: 2022-09-10 18:45:15
updateTime: 
 
# 默认随机
img: 

# 目录
toc: true

# 评论
comment: true

# 发布
publish: true

---

> 引自：https://blog.csdn.net/qq_44870156/article/details/123768179

## 渲染流程

1. 渲染引擎首先会将html元素生产节点树（dom树）
2. css会被解析成类似dom树一样的css树：这个过程比较消耗性能，样式有可能是继承和自身获取，需要遍历，所以我们的 **dom 树层级尽量要小，使用id或者class选择器，后代选择器不要太深**
3. 浏览器将dom树和css树合成为渲染树
4. 浏览器根据渲染树进行布局，输入一个盒子模型，它精确的捕获每个节点在视图内的确切的位置和尺寸，所有相对的测量指值都会转换成为屏幕上的绝对像素，通常这一行为被称为**回流和自动重排**
5. .在布局完成之后浏览器会立即发出paint setup事件，将渲染树转换成屏幕的像素，这一个过程我们通常被称为绘制，这时候我们的页面将显示在我们的屏幕上面



## 重排

当 DOM 的变化影响了元素的几何信息(元素的的位置和尺寸大小)，**使得部分渲染树（或者整个渲染树）需要重新分析并且节点尺寸需要重新计算，表现为重新生成布局，重新排列元素**

下面情况会发生重排：

- 页面初始渲染，这是开销最大的一次重排
- 添加/删除可见的DOM元素
- 改变元素位置
- 改变元素尺寸，比如边距（margin）、填充（padding）、边框（border）、宽度和高度等
- 改变元素内容，比如文字数量，图片大小等
- 改变元素字体大小
- 改变浏览器窗口尺寸，比如resize事件发生时
- 激活CSS伪类（例如：:hover）
- 通过display：none隐藏一个DOM节点
- 给页面中的DOM节点添加动画
- ...

**局部重排发生的情况：** 把一个DOM元素的宽高等几何特性定死，然后改变该元素内部的几何属性，则会触发局部重排



## 重绘

由于节点的样式发生改变，例如改变元素背景色时，屏幕上的部分内容需要更新，表现为某些元素的外观被改变，但没有改变布局。除此之外，**重排也必然会触发重绘**

除了重排触发重绘，下面情况会发生重排：

- 改变颜色
- 通过`visibility：hidden`隐藏元素
- 改变`border-style`
- 添加圆角、阴影
- `outline`
- ...



## 如何避免重排重绘

1. 减少重排的范围

尽量以局部布局的形式组织html结构，尽可能小的影响重排的范围。比如触发BFC，改变BFC内部的元素，不会影响到外部。

2. 减少重排重绘的次数

- 集中改变样式

当需要一次性对某个元素改变多种样式的情况下，使用增删 class 的方式

-  将 DOM 离线
  - `display:none`：一旦我们给元素设置 display:none 时（只有一次重排重绘），元素便不会再存在在渲染树中，相当于将其从页面上“拿掉”，我们之后的操作将不会触发重排和重绘，添加足够多的变更后，通过 display:block 属性显示（另一次重排重绘）。通过这种方式即使大量变更也只触发两次重排重绘。
  - `documentFragment`：document.createDocumentFragment 创建一个游离于 DOM 树之外的节点，然后在此节点上批量操作，最后插入 DOM 树中，只触发一次重排重绘
- 分离读写操作

**浏览器的渲染队列机制：** 当我们修改了元素的几何属性，导致浏览器触发重排或重绘时。它会把该操作放进渲染队列，等到队列中的操作到了一定的数量或者到了一定的时间间隔时，浏览器就会批量执行这些操作。

但是，一些读取元素属性的操作会强制刷新渲染队列，从而使重绘与重排提前发生。

包括：offsetTop, offsetLeft, offsetWidth, offsetHeight；scrollTop, scrollLeft, scrollWidth, scrollHeight；clientTop, clientLeft, clientWidth, clientHeight；getComputedStyle() 等

**当在循环修改元素样式时，将读取操作提到循环外用变量存储。**

















